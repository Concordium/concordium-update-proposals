<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="CIS-4: Credential Registry Standard" href="cis-4.html" /><link rel="prev" title="CIS-2: Concordium Token Standard 2" href="cis-2.html" />

    <link rel="shortcut icon" href="../_static/concordium-logo-no-text.svg"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>CIS-3: Sponsored Transaction Standard - Interoperability Specifications</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=8806b39e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Interoperability Specifications</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/concordium-logo-black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/concordium-logo-white.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Interoperability Specifications</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Protocol Updates</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../updates/P2.html">Protocol Update 2 - Alpha Centauri 2.0 - Transaction Memos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P3.html">Protocol Update 3 - Alpha Centauri 3.0 - Account Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P4.html">Protocol Update 4 - Sirius - Delegation and new contract state</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P5.html">Protocol Update 5 - Smart contract upgradability, performance improvements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P6.html">Protocol Update 6 - Concordium BFT consensus protocol, changes in Wasm validation and execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P7.html">Protocol Update 7 - Smart contract costs and new queries, stake cooldown changes, disabling shielded transfers, revised block hashing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P8.html">Protocol Update 8 - Suspension of inactive validators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P9.html">Protocol Update 9 - Protocol-Level Tokens</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Standards</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cis-0.html">CIS-0: Standard Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-1.html">CIS-1: Concordium Token Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-2.html">CIS-2: Concordium Token Standard 2</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">CIS-3: Sponsored Transaction Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-4.html">CIS-4: Credential Registry Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-5.html">CIS-5: Smart Contract Wallet Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-6.html">CIS-6: Track-and-Trace Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-7.html">CIS-7: Protocol-level Tokens (PLTs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ID/concordium-did.html">Concordium DID Method Version 1.0</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/CIS/cis-3.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="cis-3-sponsored-transaction-standard">
<span id="cis-3"></span><h1>CIS-3: Sponsored Transaction Standard<a class="headerlink" href="#cis-3-sponsored-transaction-standard" title="Link to this heading">¶</a></h1>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><th class="stub"><p>Created</p></th>
<td><p>Apr 04, 2023</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Final</p></th>
<td><p>Aug 22, 2023</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Supported versions</p></th>
<td><div class="line-block">
<div class="line">Smart contract version 1 or newer</div>
<div class="line">(Protocol version 4 or newer)</div>
</div>
</td>
</tr>
<tr class="row-even"><th class="stub"><p>Standard identifier</p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">CIS-3</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Link to this heading">¶</a></h2>
<p>A standard for how a smart contract can enable sponsored transactions.
This specification defines a mechanism for a sponsor address to submit a transaction
to a smart contract on behalf of a sponsoree account. The sponsor address (invoker to the smart contract)
pays for the transaction fees while the sponsoree has to sign its intended action in a message to authorize the sponsor to
execute a specific action on its behalf.</p>
<p>Additionally, the interface provides an entrypoint for querying the smart contract about which
entrypoints can be invoked with a sponsored transaction.
The smart contract responds with either: not supported, or supported.</p>
</section>
<section id="specification">
<h2>Specification<a class="headerlink" href="#specification" title="Link to this heading">¶</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”,  “MAY”, and “OPTIONAL” in this document are to be interpreted as described in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2119.html"><strong>RFC 2119</strong></a>.</p>
<section id="general-types-and-serialization">
<h3>General types and serialization<a class="headerlink" href="#general-types-and-serialization" title="Link to this heading">¶</a></h3>
<section id="contractaddress">
<span id="cis-3-contractaddress"></span><h4><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code><a class="headerlink" href="#contractaddress" title="Link to this heading">¶</a></h4>
<p>An address of a contract instance.
It consists of an index and a subindex both unsigned 64 bit integers.</p>
<p>It is serialized as: First 8 bytes for the index (<code class="docutils literal notranslate"><span class="pre">index</span></code>) followed by 8 bytes for the subindex (<code class="docutils literal notranslate"><span class="pre">subindex</span></code>) both little endian:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ContractAddress ::= (index: Byte⁸) (subindex: Byte⁸)
</pre></div>
</div>
</section>
<section id="accountaddress">
<span id="cis-3-accountaddress"></span><h4><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code><a class="headerlink" href="#accountaddress" title="Link to this heading">¶</a></h4>
<p>An address of an account.</p>
<p>It is serialized as 32 bytes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>AccountAddress ::= (address: Byte³²)
</pre></div>
</div>
</section>
<section id="entrypointname">
<span id="cis-3-entrypointname"></span><h4><code class="docutils literal notranslate"><span class="pre">EntrypointName</span></code><a class="headerlink" href="#entrypointname" title="Link to this heading">¶</a></h4>
<p>A name for a smart contract function entrypoint.</p>
<p>It is serialized as: First 2 bytes encode the length (<code class="docutils literal notranslate"><span class="pre">n</span></code>) of the entrypoint name, followed by this many bytes for the entrypoint name (<code class="docutils literal notranslate"><span class="pre">entrypoint</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>EntrypointName ::= (n: Byte²) (entrypoint: Byteⁿ)
</pre></div>
</div>
</section>
<section id="timestamp">
<span id="cis-3-timestamp"></span><h4><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code><a class="headerlink" href="#timestamp" title="Link to this heading">¶</a></h4>
<p>A timestamp given in milliseconds since unix epoch.
It consists of an unsigned 64 bit integer.</p>
<p>It is serialized as 8 bytes in little endian:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Timestamp ::= (milliseconds: Byte⁸)
</pre></div>
</div>
</section>
<section id="nonce">
<span id="cis-3-nonce"></span><h4><code class="docutils literal notranslate"><span class="pre">Nonce</span></code><a class="headerlink" href="#nonce" title="Link to this heading">¶</a></h4>
<p>An unsigned 64 bit integer number that increases sequentially to protect against replay attacks.</p>
<p>It is serialized as 8 bytes in little endian:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Nonce ::= (nonce: Byte⁸)
</pre></div>
</div>
</section>
<section id="signatureed25519">
<span id="cis-3-signatureed25519"></span><h4><code class="docutils literal notranslate"><span class="pre">SignatureEd25519</span></code><a class="headerlink" href="#signatureed25519" title="Link to this heading">¶</a></h4>
<p>Signature for an Ed25519 message.</p>
<p>It is serialized as 64 bytes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SignatureEd25519 ::= (signature: Byte⁶⁴)
</pre></div>
</div>
</section>
<section id="accountsignatures">
<span id="cis-3-accountsignatures"></span><h4><code class="docutils literal notranslate"><span class="pre">AccountSignatures</span></code><a class="headerlink" href="#accountsignatures" title="Link to this heading">¶</a></h4>
<p>It consists of two maps. The inner map is called <code class="docutils literal notranslate"><span class="pre">CredentialSignatures</span></code> and the outer map is called <code class="docutils literal notranslate"><span class="pre">AccountSignatures</span></code>.
Each map stores key-value pairs, where the keys are unsigned 8-bit integers in both maps.
The value in the outer map is the inner map and the value in the inner map is a byte to specify the cryptographic signature scheme
followed by the <code class="docutils literal notranslate"><span class="pre">SignatureEd25519</span></code>.</p>
<p>It is serialized as: For each map, the first byte encodes the size (<code class="docutils literal notranslate"><span class="pre">n</span></code> for the outer map and <code class="docutils literal notranslate"><span class="pre">m</span></code> for the inner map)
of the map, followed by this many key-value pairs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>KeyIndex ::= Byte
CredentialIndex ::= Byte

Signature ::= (0: Byte) SignatureEd25519

CredentialSignatures ::= (m: Byte) (key: KeyIndex, value: Signature)ᵐ
AccountSignatures ::= (n: Byte) (key: CredentialIndex, value: CredentialSignatures)ⁿ
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each account address on Concordium is controlled by one or several credential(s) (real-world identities)
and each credential has one or several public-private key pair(s). There are two thresholds associated with these maps.
The outer map has an <code class="docutils literal notranslate"><span class="pre">AccountThreshold</span></code> (number of credentials needed to sign the transaction initiated by that account)
and the inner map has a <code class="docutils literal notranslate"><span class="pre">SignatureThreshold</span></code> (number of signatures needed for a specific credential
so that this credential is considered to have signed the transaction initiated by that account).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Signature</span></code> type can support different cryptographic signature schemes. The first byte is used
to identify which schema to use. Currently, only the <code class="docutils literal notranslate"><span class="pre">SignatureEd25519</span></code> schema is supported.
The first byte in <code class="docutils literal notranslate"><span class="pre">Signature</span></code> type is hence set to <code class="docutils literal notranslate"><span class="pre">0</span></code> to specify an ed25519 signature.</p>
</div>
</section>
</section>
<section id="logged-events">
<h3>Logged events<a class="headerlink" href="#logged-events" title="Link to this heading">¶</a></h3>
<p>Entrypoints invoked via the <code class="docutils literal notranslate"><span class="pre">permit</span></code> function using the sponsored
transaction mechanism MUST log the same events as if they were invoked
by the sponsoree directly without the sponsored transaction mechanism.
In addition, the <code class="docutils literal notranslate"><span class="pre">permit</span></code> function SHALL log an event with the <code class="docutils literal notranslate"><span class="pre">nonce</span></code> and the <code class="docutils literal notranslate"><span class="pre">sponsoree</span></code> address every time
the <cite>permit</cite> function is invoked.</p>
<p>The event defined by this specification is serialized using one byte to discriminate it from other events logged by the smart contract.
Other events logged by the smart contract SHOULD NOT have a first byte colliding with the event defined by this specification.</p>
<section id="nonceevent">
<h4><code class="docutils literal notranslate"><span class="pre">NonceEvent</span></code><a class="headerlink" href="#nonceevent" title="Link to this heading">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">NonceEvent</span></code> SHALL be logged for every <code class="docutils literal notranslate"><span class="pre">permit</span></code> function invoke.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NonceEvent</span></code> is serialized as: First a byte with the value of 250, followed by the <a class="reference internal" href="#cis-3-nonce"><span class="std std-ref">Nonce</span></a> (<code class="docutils literal notranslate"><span class="pre">nonce</span></code>) that was used in the PermitMessage, and an <a class="reference internal" href="#cis-3-accountaddress"><span class="std std-ref">AccountAddress</span></a> (<code class="docutils literal notranslate"><span class="pre">sponsoree</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NonceEvent ::= (250: Byte) (nonce: Nonce) (sponsoree: AccountAddress)
</pre></div>
</div>
</section>
</section>
<section id="contract-function">
<h3>Contract function<a class="headerlink" href="#contract-function" title="Link to this heading">¶</a></h3>
<p>A smart contract implementing CIS-3 MUST export the functions: <a class="reference internal" href="#cis-3-functions-permit"><span class="std std-ref">permit</span></a> and <a class="reference internal" href="#cis-3-functions-supportspermit"><span class="std std-ref">supportsPermit</span></a>.</p>
<section id="permit">
<span id="cis-3-functions-permit"></span><h4><code class="docutils literal notranslate"><span class="pre">permit</span></code><a class="headerlink" href="#permit" title="Link to this heading">¶</a></h4>
<p>Verifies an ed25519 signature from a sponsoree and authorizes the sponsor to execute the logic of
specific entrypoints on behalf of the sponsoree. The sponsored transaction mechanism replaces the
authorization checks conducted on the <cite>sender/invoker</cite> variable with signature verification.
That is, the sponsoree needs to sign its intended action and the signature is verified in the smart contract.</p>
<section id="parameter">
<h5>Parameter<a class="headerlink" href="#parameter" title="Link to this heading">¶</a></h5>
<p>The parameter (<code class="docutils literal notranslate"><span class="pre">PermitParam</span></code>) contains a two-level signature map and a signer account that created the signature
together with the message that was signed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The CIS3 standard supports multi-sig accounts which is the purpose of the two-level signature map. A basic account (no multi-sig account) SHOULD have its signature at the key 0 in both maps.</p>
</div>
<p>The message (<code class="docutils literal notranslate"><span class="pre">PermitMessage</span></code>) contains a contract_address (<code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code>), entry_point (<code class="docutils literal notranslate"><span class="pre">EntrypointName</span></code>), nonce (<code class="docutils literal notranslate"><span class="pre">Nonce</span></code>), timestamp (<code class="docutils literal notranslate"><span class="pre">Timestamp</span></code>), and the payload (<code class="docutils literal notranslate"><span class="pre">PermitPayload</span></code>).
This message structure enables the sponsoree the authorize the sponsor to act on its behalf in the given scope.</p>
<p>The payload (<code class="docutils literal notranslate"><span class="pre">PermitPayload</span></code>) is serialized as: First 2 bytes encode the length (<code class="docutils literal notranslate"><span class="pre">n</span></code>) of the payload, followed by this many bytes for the payload (<code class="docutils literal notranslate"><span class="pre">entrypoint_parameter</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>PermitPayload ::= (n: Byte²) (entrypoint_parameter: Byteⁿ)

PermitMessage ::= (contract_address: ContractAddress) (nonce: Nonce) (timestamp: Timestamp) (entry_point: EntrypointName) (payload: PermitPayload)

PermitParam ::= (signature: AccountSignatures) (signer: AccountAddress) (message: PermitMessage)
</pre></div>
</div>
</section>
<section id="requirements">
<h5>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>The requirements specified for an entrypoint and the outcome of the invoke MUST be the same as if it was invoked directly by the sponsoree. E.g. a smart contract implementing an <cite>updateOperator/transfer</cite> function from the CIS-2 standard, if these entrypoints are invoked via the <cite>permit</cite> function, the sponsored transaction invoke MUST adhere to the CIS-2 standard as well and create the same outcome as if the sponsoree invokes the <cite>updateOperator/transfer</cite> function directly.</p></li>
<li><p>The PermitMessage MUST include a nonce to protect against replay attacks. The sponsoree’s nonce is sequentially increased every time a <code class="docutils literal notranslate"><span class="pre">PermitMessage</span></code> (signed by the sponsoree) is successfully executed in the <cite>permit</cite> function. The <cite>permit</cite> function MUST only accept a <cite>PermitMessage</cite> if it has the next nonce following the sequential order.</p></li>
<li><p>An invoke MUST fail if the signature was intended for a different contract.</p></li>
<li><p>An invoke MUST fail if the signature was intended for a different entrypoint.</p></li>
<li><p>An invoke MUST fail if the signature is expired.</p></li>
<li><p>An invoke MUST fail if the signature can not be validated. The smart contract logic SHOULD practice its best efforts to ensure that only the sponsoree can generate and authorize its intended action with a valid signature.</p></li>
</ul>
</section>
</section>
<section id="supportspermit">
<span id="cis-3-functions-supportspermit"></span><h4><code class="docutils literal notranslate"><span class="pre">supportsPermit</span></code><a class="headerlink" href="#supportspermit" title="Link to this heading">¶</a></h4>
<p>Query supported entrypoints by the <code class="docutils literal notranslate"><span class="pre">permit</span></code> function given a list of entrypoints.
The response contains a corresponding result for each entrypoint, where the result is either
“Entrypoint is not supported and can not be invoked via the <code class="docutils literal notranslate"><span class="pre">permit</span></code> function using the sponsored transaction mechanism” or “Entrypoint is supported and can be invoked via the <code class="docutils literal notranslate"><span class="pre">permit</span></code> function using the sponsored transaction mechanism”.</p>
<section id="id1">
<h5>Parameter<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h5>
<p>The parameter consists of a list of entrypoints.</p>
<p>It is serialized as: 2 bytes for the number (little endian) of the entrypoints and then this number of <code class="docutils literal notranslate"><span class="pre">EntrypointNames</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SupportsPermitQueryParams ::= (n : Byte²) (names: EntrypointNameⁿ)
</pre></div>
</div>
</section>
<section id="response">
<h5>Response<a class="headerlink" href="#response" title="Link to this heading">¶</a></h5>
<p>The function output is a list of support results, where the order of the support results matches the order of <code class="docutils literal notranslate"><span class="pre">EntrypointNames</span></code> in the parameter.</p>
<p>It is serialized as: 2 bytes for the number (little endian) of results (<code class="docutils literal notranslate"><span class="pre">n</span></code>) and then this number of support results (<code class="docutils literal notranslate"><span class="pre">results</span></code>).
A support result is serialized as either: A byte with value <code class="docutils literal notranslate"><span class="pre">0</span></code> for “Entrypoint is not supported” or a byte with the value <code class="docutils literal notranslate"><span class="pre">1</span></code> for “Entrypoint is supported by this contract”:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SupportResult ::= (0 : Byte)  // Entrypoint is not supported by the `permit` function
                | (1 : Byte)  // Entrypoint is supported by the `permit` function

SupportsResponse ::= (n : Byte²) (results: SupportResultⁿ)
</pre></div>
</div>
</section>
<section id="id2">
<h5>Requirements<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>The number of results in the response MUST correspond to the number of queries in the parameter.</p></li>
<li><p>The order of results in the response MUST correspond to the order of queries in the parameter.</p></li>
<li><p>The contract function MUST be non-mutative.</p></li>
</ul>
</section>
</section>
</section>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Link to this heading">¶</a></h2>
<p>A number of limitations are important to be aware of:</p>
<ul class="simple">
<li><p>Only accounts can generate a valid Ed25519 signature using public-private key cryptography. Smart contracts can not be a sponsoree as defined in this CIS-3 standard.</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cis-4.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">CIS-4: Credential Registry Standard</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="cis-2.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">CIS-2: Concordium Token Standard 2</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021, Concordium
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">CIS-3: Sponsored Transaction Standard</a><ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#general-types-and-serialization">General types and serialization</a><ul>
<li><a class="reference internal" href="#contractaddress"><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code></a></li>
<li><a class="reference internal" href="#accountaddress"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a></li>
<li><a class="reference internal" href="#entrypointname"><code class="docutils literal notranslate"><span class="pre">EntrypointName</span></code></a></li>
<li><a class="reference internal" href="#timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a></li>
<li><a class="reference internal" href="#nonce"><code class="docutils literal notranslate"><span class="pre">Nonce</span></code></a></li>
<li><a class="reference internal" href="#signatureed25519"><code class="docutils literal notranslate"><span class="pre">SignatureEd25519</span></code></a></li>
<li><a class="reference internal" href="#accountsignatures"><code class="docutils literal notranslate"><span class="pre">AccountSignatures</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#logged-events">Logged events</a><ul>
<li><a class="reference internal" href="#nonceevent"><code class="docutils literal notranslate"><span class="pre">NonceEvent</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#contract-function">Contract function</a><ul>
<li><a class="reference internal" href="#permit"><code class="docutils literal notranslate"><span class="pre">permit</span></code></a><ul>
<li><a class="reference internal" href="#parameter">Parameter</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#supportspermit"><code class="docutils literal notranslate"><span class="pre">supportsPermit</span></code></a><ul>
<li><a class="reference internal" href="#id1">Parameter</a></li>
<li><a class="reference internal" href="#response">Response</a></li>
<li><a class="reference internal" href="#id2">Requirements</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>