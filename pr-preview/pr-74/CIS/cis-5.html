<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="CIS-6: Track-and-Trace Standard" href="cis-6.html" /><link rel="prev" title="CIS-4: Credential Registry Standard" href="cis-4.html" />

    <link rel="shortcut icon" href="../_static/concordium-logo-no-text.svg"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>CIS-5: Smart Contract Wallet Standard - Interoperability Specifications</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=8806b39e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Interoperability Specifications</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/concordium-logo-black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/concordium-logo-white.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Interoperability Specifications</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Protocol Updates</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../updates/P2.html">Protocol Update 2 - Alpha Centauri 2.0 - Transaction Memos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P3.html">Protocol Update 3 - Alpha Centauri 3.0 - Account Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P4.html">Protocol Update 4 - Sirius - Delegation and new contract state</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P5.html">Protocol Update 5 - Smart contract upgradability, performance improvements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P6.html">Protocol Update 6 - Concordium BFT consensus protocol, changes in Wasm validation and execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P7.html">Protocol Update 7 - Smart contract costs and new queries, stake cooldown changes, disabling shielded transfers, revised block hashing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P8.html">Protocol Update 8 - Suspension of inactive validators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/P9.html">Protocol Update 9 - Protocol-Level Tokens</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Standards</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cis-0.html">CIS-0: Standard Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-1.html">CIS-1: Concordium Token Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-2.html">CIS-2: Concordium Token Standard 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-3.html">CIS-3: Sponsored Transaction Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-4.html">CIS-4: Credential Registry Standard</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">CIS-5: Smart Contract Wallet Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-6.html">CIS-6: Track-and-Trace Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="cis-7.html">CIS-7: Protocol-level Tokens (PLTs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ID/concordium-did.html">Concordium DID Method Version 1.0</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/CIS/cis-5.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="cis-5-smart-contract-wallet-standard">
<span id="cis-5"></span><h1>CIS-5: Smart Contract Wallet Standard<a class="headerlink" href="#cis-5-smart-contract-wallet-standard" title="Link to this heading">¶</a></h1>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><th class="stub"><p>Created</p></th>
<td><p>Mar 17, 2024</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Final</p></th>
<td><p>May 23, 2024</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Supported versions</p></th>
<td><div class="line-block">
<div class="line">Smart contract version 1 or newer</div>
<div class="line">(Protocol version 4 or newer)</div>
</div>
</td>
</tr>
<tr class="row-even"><th class="stub"><p>Standard identifier</p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">CIS-5</span></code></p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Requires</p></th>
<td><p><a class="reference internal" href="cis-0.html#cis-0"><span class="std std-ref">CIS-0</span></a></p></td>
</tr>
</tbody>
</table>
</div>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Link to this heading">¶</a></h2>
<p>A standard interface for defining a smart contract wallet that can hold and transfer CCDs and CIS-2 tokens.
CCDs/CIS-2 tokens can be deposited into the smart contract wallet by
specifying to which public key the deposit should be assigned.</p>
<p>The holder of the corresponding private key does not submit transactions
on chain to transfer/withdraw its CCD/CIS-2 token balances,
but instead, it can generate a valid signature, identify a willing third
party to submit its signature in a transaction on-chain (a service fee can be added to financially incentivize a third party to do so).</p>
<p>The three main actions in the smart contract that can be taken:</p>
<ul class="simple">
<li><p><em>deposit</em>: assigns the balance to a public key within the smart contract wallet.</p></li>
<li><p><em>internal transfer</em>: assigns the balance to a new public key within the smart contract wallet.</p></li>
<li><p><em>withdraw</em>: withdraws the balance out of the smart contract wallet to a native account or smart contract.</p></li>
</ul>
<p>The goal of this standard is to create an alternative simplified onboarding flow
without the inconvenience of a native account creation on Concordium.
Allowing for CIS-5 smart contract wallets to be supported as first-class citizens in Concordium wallets and tooling.</p>
</section>
<section id="specification">
<h2>Specification<a class="headerlink" href="#specification" title="Link to this heading">¶</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”,  “MAY”, and “OPTIONAL” in this document are to be interpreted as described in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2119.html"><strong>RFC 2119</strong></a>.</p>
<section id="general-types-and-serialization">
<h3>General types and serialization<a class="headerlink" href="#general-types-and-serialization" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Integers are encoded in little-endian unless stated otherwise.</p>
</div>
<section id="tokenid">
<span id="cis-5-tokenid"></span><h4><code class="docutils literal notranslate"><span class="pre">TokenID</span></code><a class="headerlink" href="#tokenid" title="Link to this heading">¶</a></h4>
<p>The token ID is from the CIS-2 standard <a class="reference internal" href="cis-2.html#cis-2-tokenid"><span class="std std-ref">TokenID</span></a>.
A token ID is serialized as 1 byte for the size (<code class="docutils literal notranslate"><span class="pre">n</span></code>) of the identifier, followed by this number of bytes for the token id (<code class="docutils literal notranslate"><span class="pre">id</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TokenID ::= (n: Byte) (id: Byteⁿ)
</pre></div>
</div>
</section>
<section id="tokenamount">
<span id="cis-5-tokenamount"></span><h4><code class="docutils literal notranslate"><span class="pre">TokenAmount</span></code><a class="headerlink" href="#tokenamount" title="Link to this heading">¶</a></h4>
<p>The token amount is from the CIS-2 standard <a class="reference internal" href="cis-2.html#cis-2-tokenamount"><span class="std std-ref">TokenAmount</span></a>.
It is serialized using the <a class="reference external" href="https://en.wikipedia.org/wiki/LEB128">LEB128</a> variable-length unsigned integer encoding, with the additional constraint that the total number of bytes of the encoding MUST not exceed 37 bytes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TokenAmount ::= (x: Byte)                   =&gt;  x                     if x &lt; 2^7
              | (x: Byte) (m: TokenAmount)  =&gt;  (x - 2^7) + 2^7 * m   if x &gt;= 2^7
</pre></div>
</div>
</section>
<section id="cis5-externaltokenamount">
<span id="cis-5-externaltokenamount"></span><h4><code class="docutils literal notranslate"><span class="pre">CIS5-ExternalTokenAmount</span></code><a class="headerlink" href="#cis5-externaltokenamount" title="Link to this heading">¶</a></h4>
<p>A CIS-2 token amount on a blockchain defined by the amount, token id and smart contract it represents.</p>
<p>It is serialized as a <a class="reference internal" href="#cis-5-tokenamount"><span class="std std-ref">TokenAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">tokenAmount</span></code>), a <a class="reference internal" href="#cis-5-tokenid"><span class="std std-ref">TokenID</span></a> (<code class="docutils literal notranslate"><span class="pre">tokenId</span></code>), and a <a class="reference internal" href="#cis-5-contractaddress"><span class="std std-ref">ContractAddress</span></a> (<code class="docutils literal notranslate"><span class="pre">cis2TokenContractAddress</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ExternalTokenAmount ::=  (tokenAmount: TokenAmount) (tokenId: TokenId) (cis2TokenContractAddress: ContractAddress)
</pre></div>
</div>
</section>
<section id="accountaddress">
<span id="cis-5-accountaddress"></span><h4><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code><a class="headerlink" href="#accountaddress" title="Link to this heading">¶</a></h4>
<p>An address of an account.</p>
<p>It is serialized as 32 bytes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>AccountAddress ::= (address: Byte³²)
</pre></div>
</div>
</section>
<section id="contractaddress">
<span id="cis-5-contractaddress"></span><h4><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code><a class="headerlink" href="#contractaddress" title="Link to this heading">¶</a></h4>
<p>An address of a contract instance.
It consists of an index and a subindex, both unsigned 64-bit integers.</p>
<p>It is serialized as: First 8 bytes for the index (<code class="docutils literal notranslate"><span class="pre">index</span></code>) followed by 8 bytes for the subindex (<code class="docutils literal notranslate"><span class="pre">subindex</span></code>), both little-endian:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ContractAddress ::= (index: Byte⁸) (subindex: Byte⁸)
</pre></div>
</div>
</section>
<section id="address">
<span id="cis-5-address"></span><h4><code class="docutils literal notranslate"><span class="pre">Address</span></code><a class="headerlink" href="#address" title="Link to this heading">¶</a></h4>
<p>Is either an <a class="reference internal" href="#cis-5-accountaddress"><span class="std std-ref">AccountAddress</span></a> or a <a class="reference internal" href="#cis-5-contractaddress"><span class="std std-ref">ContractAddress</span></a>.</p>
<p>It is serialized as: The first byte indicates whether it is an account address or a contract address.
In case the first byte is 0 then an <a class="reference internal" href="#cis-5-accountaddress"><span class="std std-ref">AccountAddress</span></a> (<code class="docutils literal notranslate"><span class="pre">address</span></code>) follows.
In case the first byte is 1 then a <a class="reference internal" href="#cis-5-contractaddress"><span class="std std-ref">ContractAddress</span></a> (<code class="docutils literal notranslate"><span class="pre">address</span></code>) follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Address ::= (0: Byte) (address: AccountAddress)
          | (1: Byte) (address: ContractAddress)
</pre></div>
</div>
</section>
<section id="entrypointname">
<span id="cis-5-entrypointname"></span><h4><code class="docutils literal notranslate"><span class="pre">EntrypointName</span></code><a class="headerlink" href="#entrypointname" title="Link to this heading">¶</a></h4>
<p>A name for a smart contract function entrypoint.</p>
<p>It is serialized as: First 2 bytes encode the length (<code class="docutils literal notranslate"><span class="pre">n</span></code>) of the entrypoint name in little-endian, followed by this many bytes for the entrypoint name (<code class="docutils literal notranslate"><span class="pre">entrypoint</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>EntrypointName ::= (n: Byte²) (entrypoint: Byteⁿ)
</pre></div>
</div>
</section>
<section id="timestamp">
<span id="cis-5-timestamp"></span><h4><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code><a class="headerlink" href="#timestamp" title="Link to this heading">¶</a></h4>
<p>A timestamp given in milliseconds since Unix epoch.
It consists of an unsigned 64-bit integer.</p>
<p>It is serialized as 8 bytes in little-endian:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Timestamp ::= (milliseconds: Byte⁸)
</pre></div>
</div>
</section>
<section id="nonce">
<span id="cis-5-nonce"></span><h4><code class="docutils literal notranslate"><span class="pre">Nonce</span></code><a class="headerlink" href="#nonce" title="Link to this heading">¶</a></h4>
<p>An unsigned 64-bit integer number that increases sequentially to protect against replay attacks.</p>
<p>It is serialized as 8 bytes in little-endian:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Nonce ::= (nonce: Byte⁸)
</pre></div>
</div>
</section>
<section id="ccdamount">
<span id="cis-5-ccdamount"></span><h4><code class="docutils literal notranslate"><span class="pre">CCDAmount</span></code><a class="headerlink" href="#ccdamount" title="Link to this heading">¶</a></h4>
<p>An unsigned 64-bit integer number.</p>
<p>It is serialized as 8 bytes in little-endian:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CCDAmount ::= (ccdAmount: Byte⁸)
</pre></div>
</div>
</section>
<section id="publickeyed25519">
<span id="cis-5-publickeyed25519"></span><h4><code class="docutils literal notranslate"><span class="pre">PublicKeyEd25519</span></code><a class="headerlink" href="#publickeyed25519" title="Link to this heading">¶</a></h4>
<p>An Ed25519 public key is represented as a 32-byte array.</p>
<p>It is serialized as 32 bytes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>PublicKeyEd25519 ::= (key: Byte³²)
</pre></div>
</div>
</section>
<section id="signatureed25519">
<span id="cis-5-signatureed25519"></span><h4><code class="docutils literal notranslate"><span class="pre">SignatureEd25519</span></code><a class="headerlink" href="#signatureed25519" title="Link to this heading">¶</a></h4>
<p>Signature for an Ed25519 message.</p>
<p>It is serialized as 64 bytes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SignatureEd25519 ::= (signature: Byte⁶⁴)
</pre></div>
</div>
</section>
<section id="chaincontext">
<span id="cis-5-chaincontext"></span><h4><code class="docutils literal notranslate"><span class="pre">ChainContext</span></code><a class="headerlink" href="#chaincontext" title="Link to this heading">¶</a></h4>
<p>The chain context consists of the genesis hash and the contract address to prevent re-playing signatures across the testnet/mainnet chain and smart contracts.</p>
<p>It is serialized as: First 32 bytes defining the genesisHash (its hex string representation converted into bytes),
followed by 8 bytes for the index of the smart contract address and 8 bytes for the subindex of the smart contract address:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ChainContext ::= (genesisHash: Byte³²) (index: Byte⁸) (subindex: Byte⁸)
</pre></div>
</div>
</section>
</section>
<section id="logged-events">
<h3>Logged events<a class="headerlink" href="#logged-events" title="Link to this heading">¶</a></h3>
<p>The event defined by this specification is serialized using one byte to discriminate it from other events logged by the smart contract.
Other events logged by the smart contract SHOULD NOT have a first byte colliding with the event defined by this specification.</p>
<section id="nonceevent">
<h4><code class="docutils literal notranslate"><span class="pre">NonceEvent</span></code><a class="headerlink" href="#nonceevent" title="Link to this heading">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">NonceEvent</span></code> SHALL be logged every time a signature is successfully processed and considered valid by the contract.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NonceEvent</span></code> is serialized as: First a byte with the value of 250, followed by the <a class="reference internal" href="#cis-5-nonce"><span class="std std-ref">Nonce</span></a> (<code class="docutils literal notranslate"><span class="pre">nonce</span></code>) that is used in the SigningData, and an <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">sponsoree</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NonceEvent ::= (250: Byte) (nonce: Nonce) (sponsoree: PublicKeyEd25519)
</pre></div>
</div>
</section>
<section id="depositccdevent">
<h4><code class="docutils literal notranslate"><span class="pre">DepositCcdEvent</span></code><a class="headerlink" href="#depositccdevent" title="Link to this heading">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">DepositCcdEvent</span></code> SHALL be logged every time an amount of CCD received by the contract is assigned to a public key.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DepositCcdEvent</span></code> is serialized as: First a byte with the value of 249, followed by the <a class="reference internal" href="#cis-5-ccdamount"><span class="std std-ref">CCDAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">ccdAmount</span></code>), the <a class="reference internal" href="#cis-5-address"><span class="std std-ref">Address</span></a> (<code class="docutils literal notranslate"><span class="pre">from</span></code>), and a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>DepositCcdEvent ::= (249: Byte) (ccdAmount: CCDAmount) (from: Address) (to: PublicKeyEd25519)
</pre></div>
</div>
</section>
<section id="depositcis2tokensevent">
<h4><code class="docutils literal notranslate"><span class="pre">DepositCis2TokensEvent</span></code><a class="headerlink" href="#depositcis2tokensevent" title="Link to this heading">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">DepositCis2TokensEvent</span></code> SHALL be logged every time a token amount received by the contract is assigned to a public key.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DepositCis2TokensEvent</span></code> is serialized as: First a byte with the value of 248, followed by the
<a class="reference internal" href="#cis-5-tokenamount"><span class="std std-ref">TokenAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">tokenAmount</span></code>), <a class="reference internal" href="#cis-5-tokenid"><span class="std std-ref">TokenID</span></a> (<code class="docutils literal notranslate"><span class="pre">TokenID</span></code>),
<a class="reference internal" href="#cis-5-contractaddress"><span class="std std-ref">ContractAddress</span></a> (<code class="docutils literal notranslate"><span class="pre">cis2TokenContractAddress</span></code>), the <a class="reference internal" href="#cis-5-address"><span class="std std-ref">Address</span></a> (<code class="docutils literal notranslate"><span class="pre">from</span></code>), and a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>DepositCis2TokensEvent ::= (248: Byte) (tokenAmount: TokenAmount) (tokenId: TokenID) (cis2TokenContractAddress: ContractAddress) (from: Address) (to: PublicKeyEd25519)
</pre></div>
</div>
</section>
<section id="withdrawccdevent">
<h4><code class="docutils literal notranslate"><span class="pre">WithdrawCcdEvent</span></code><a class="headerlink" href="#withdrawccdevent" title="Link to this heading">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">WithdrawCcdEvent</span></code> SHALL be logged every time an amount of CCD held by a public key is withdrawn to an address.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">WithdrawCcdEvent</span></code> is serialized as: First a byte with the value of 247, followed by the <a class="reference internal" href="#cis-5-ccdamount"><span class="std std-ref">CCDAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">ccdAmount</span></code>), a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">from</span></code>), and the <a class="reference internal" href="#cis-5-address"><span class="std std-ref">Address</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WithdrawCcdEvent ::= (247: Byte) (ccdAmount: CCDAmount) (from: PublicKeyEd25519) (to: Address)
</pre></div>
</div>
</section>
<section id="withdrawcis2tokensevent">
<h4><code class="docutils literal notranslate"><span class="pre">WithdrawCis2TokensEvent</span></code><a class="headerlink" href="#withdrawcis2tokensevent" title="Link to this heading">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">WithdrawCis2TokensEvent</span></code> SHALL be logged every time a token amount held by a public key is withdrawn to an address.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">WithdrawCis2TokensEvent</span></code> is serialized as: First a byte with the value of 246, followed by the
<a class="reference internal" href="#cis-5-tokenamount"><span class="std std-ref">TokenAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">tokenAmount</span></code>), <a class="reference internal" href="#cis-5-tokenid"><span class="std std-ref">TokenID</span></a> (<code class="docutils literal notranslate"><span class="pre">TokenID</span></code>),
<a class="reference internal" href="#cis-5-contractaddress"><span class="std std-ref">ContractAddress</span></a> (<code class="docutils literal notranslate"><span class="pre">cis2TokenContractAddress</span></code>), a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">from</span></code>), and the <a class="reference internal" href="#cis-5-address"><span class="std std-ref">Address</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WithdrawCis2TokensEvent ::= (246: Byte) (tokenAmount: TokenAmount) (tokenId: TokenID) (cis2TokenContractAddress: ContractAddress) (from: PublicKeyEd25519) (to: Address)
</pre></div>
</div>
</section>
<section id="transferccdevent">
<h4><code class="docutils literal notranslate"><span class="pre">TransferCcdEvent</span></code><a class="headerlink" href="#transferccdevent" title="Link to this heading">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">TransferCcdEvent</span></code> SHALL be logged every time an amount of CCD held by a public key is transferred to another public key within the contract.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TransferCcdEvent</span></code> is serialized as: First a byte with the value of 245, followed by the <a class="reference internal" href="#cis-5-ccdamount"><span class="std std-ref">CCDAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">ccdAmount</span></code>), a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">from</span></code>), and the <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TransferCcdEvent ::= (245: Byte) (ccdAmount: CCDAmount) (from: PublicKeyEd25519) (to: PublicKeyEd25519)
</pre></div>
</div>
</section>
<section id="transfercis2tokensevent">
<h4><code class="docutils literal notranslate"><span class="pre">TransferCis2TokensEvent</span></code><a class="headerlink" href="#transfercis2tokensevent" title="Link to this heading">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">TransferCis2TokensEvent</span></code> SHALL be logged every time a token amount held by a public key is transferred to another public key within the contract.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TransferCis2TokensEvent</span></code> is serialized as: First a byte with the value of 244, followed by the
<a class="reference internal" href="#cis-5-tokenamount"><span class="std std-ref">TokenAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">tokenAmount</span></code>), <a class="reference internal" href="#cis-5-tokenid"><span class="std std-ref">TokenID</span></a> (<code class="docutils literal notranslate"><span class="pre">TokenID</span></code>),
<a class="reference internal" href="#cis-5-contractaddress"><span class="std std-ref">ContractAddress</span></a> (<code class="docutils literal notranslate"><span class="pre">cis2TokenContractAddress</span></code>), a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">from</span></code>), and the <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TransferCis2TokensEvent ::= (244: Byte) (tokenAmount: TokenAmount) (tokenId: TokenID) (cis2TokenContractAddress: ContractAddress) (from: PublicKeyEd25519) (to: PublicKeyEd25519)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The collection of all CIS-5 events emitted by a smart contract instance implementing CIS-5 SHALL enable off-chain applications to compute off-chain all non-zero balances that the public keys are holding.</p>
</div>
</section>
</section>
<section id="contract-functions">
<span id="cis-5-functions"></span><h3>Contract functions<a class="headerlink" href="#contract-functions" title="Link to this heading">¶</a></h3>
<p>A smart contract implementing this standard MUST export the following functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#cis-5-functions-depositccd"><span class="std std-ref">depositCcd</span></a></p></li>
<li><p><a class="reference internal" href="#cis-5-functions-depositcis2tokens"><span class="std std-ref">depositCis2Tokens</span></a></p></li>
<li><p><a class="reference internal" href="#cis-5-functions-withdrawccd"><span class="std std-ref">withdrawCcd</span></a></p></li>
<li><p><a class="reference internal" href="#cis-5-functions-withdrawcis2tokens"><span class="std std-ref">withdrawCis2Tokens</span></a></p></li>
<li><p><a class="reference internal" href="#cis-5-functions-transferccd"><span class="std std-ref">transferCcd</span></a></p></li>
<li><p><a class="reference internal" href="#cis-5-functions-transfercis2tokens"><span class="std std-ref">transferCis2Tokens</span></a></p></li>
<li><p><a class="reference internal" href="#cis-5-functions-ccdbalanceof"><span class="std std-ref">ccdBalanceOf</span></a></p></li>
<li><p><a class="reference internal" href="#cis-5-functions-cis2balanceof"><span class="std std-ref">cis2BalanceOf</span></a></p></li>
</ul>
<section id="depositccd">
<span id="cis-5-functions-depositccd"></span><h4><code class="docutils literal notranslate"><span class="pre">depositCcd</span></code><a class="headerlink" href="#depositccd" title="Link to this heading">¶</a></h4>
<p>The function is payable and deposits/assigns the send CCDAmount to a public key (<code class="docutils literal notranslate"><span class="pre">PublicKeyEd25519</span></code>).</p>
<section id="parameter">
<h5>Parameter<a class="headerlink" href="#parameter" title="Link to this heading">¶</a></h5>
<p>The parameter is a <code class="docutils literal notranslate"><span class="pre">PublicKeyEd25519</span></code>.</p>
<p>See the serialization rules in <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a>.</p>
</section>
</section>
<section id="depositcis2tokens">
<span id="cis-5-functions-depositcis2tokens"></span><h4><code class="docutils literal notranslate"><span class="pre">depositCis2Tokens</span></code><a class="headerlink" href="#depositcis2tokens" title="Link to this heading">¶</a></h4>
<p>This function SHOULD be called through the receive hook mechanism (<a class="reference internal" href="cis-2.html#cis-2-receive-hook-function"><span class="std std-ref">Receive hook function</span></a>)
of a CIS-2 token contract. The function deposits/assigns the send CIS-2 token amount to a public key (<code class="docutils literal notranslate"><span class="pre">PublicKeyEd25519</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">depositCis2Tokens</span></code> function can be called by any smart contract. It is up to the exact implementation of the smart contract wallet whether it should trust the caller or not.
The smart contract wallet is not required to check if the invoking contract is a CIS-2 token contract or has some reasonable receive hook logic implemented.
If no additional authorization is added to this function, similar caution should be applied as if you would directly interact with any CIS-2 token contract.
Only interact with a CIS-2 token contract or value its recorded token balance if you checked its smart
contract logic or reasonable social reputation is given to the project/CIS-2 token contract.</p>
</div>
<section id="id1">
<h5>Parameter<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h5>
<p>The parameter is the <a class="reference internal" href="cis-2.html#cis-2-functions-transfer-receive-hook-parameter"><span class="std std-ref">Receive hook parameter</span></a> (<code class="docutils literal notranslate"><span class="pre">OnReceivingCis2Params</span></code>) and the
<code class="docutils literal notranslate"><span class="pre">data</span></code> field of the <code class="docutils literal notranslate"><span class="pre">OnReceivingCis2Params</span></code> SHALL encode a <code class="docutils literal notranslate"><span class="pre">PublicKeyEd25519</span></code>.</p>
<p>See the serialization rules in <a class="reference internal" href="cis-2.html#cis-2-functions-transfer-receive-hook-parameter"><span class="std std-ref">Receive hook parameter</span></a>
and the serialization rules in <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a>.</p>
</section>
<section id="requirements">
<h5>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>The function SHOULD check that a contract is the caller since only a contract can implement a receive hook mechanism.</p></li>
</ul>
</section>
</section>
<section id="withdrawccd">
<span id="cis-5-functions-withdrawccd"></span><h4><code class="docutils literal notranslate"><span class="pre">withdrawCcd</span></code><a class="headerlink" href="#withdrawccd" title="Link to this heading">¶</a></h4>
<p>The function executes a list of token withdrawals of CCDs to native accounts and/or smart contracts out of the smart contract wallet.
When transferring CCD to a contract address, a CCD receive hook function MUST be triggered.</p>
<section id="id2">
<h5>Parameter<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h5>
<p>The parameter is a list of withdrawals.</p>
<p>It is serialized as: 2 bytes representing the number of withdrawals (<code class="docutils literal notranslate"><span class="pre">n</span></code>) followed by the bytes for this number of <code class="docutils literal notranslate"><span class="pre">withdrawals</span></code>.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">WithdrawBatchCcdAmount</span></code> is serialized as: a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">signer</span></code>), a <a class="reference internal" href="#cis-5-signatureed25519"><span class="std std-ref">SignatureEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">signature</span></code>), and  a <code class="docutils literal notranslate"><span class="pre">WithdrawMessageCcdAmount</span></code> (<code class="docutils literal notranslate"><span class="pre">message</span></code>).</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">WithdrawMessageCcdAmount</span></code> is serialized as: an <a class="reference internal" href="#cis-5-entrypointname"><span class="std std-ref">EntrypointName</span></a> (<code class="docutils literal notranslate"><span class="pre">entryPoint</span></code>), a <a class="reference internal" href="#cis-5-timestamp"><span class="std std-ref">Timestamp</span></a> (<code class="docutils literal notranslate"><span class="pre">expiryTime</span></code>), a <a class="reference internal" href="#cis-5-nonce"><span class="std std-ref">Nonce</span></a> (<code class="docutils literal notranslate"><span class="pre">nonce</span></code>), a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">serviceFeeRecipient</span></code>), a <a class="reference internal" href="#cis-5-ccdamount"><span class="std std-ref">CCDAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">serviceFee</span></code>), 2 bytes representing the number of simple withdraws (<code class="docutils literal notranslate"><span class="pre">m</span></code>) followed by the bytes for this number of simple withdraws (<code class="docutils literal notranslate"><span class="pre">simpleWithdraws</span></code>).</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">WithdrawCcdAmount</span></code> is serialized as: the receiving address <a class="reference internal" href="cis-2.html#cis-2-receiver"><span class="std std-ref">Receiver</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>), the <a class="reference internal" href="#cis-5-ccdamount"><span class="std std-ref">CCDAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">withdrawAmount</span></code>), and some additional data <a class="reference internal" href="cis-2.html#cis-2-additionaldata"><span class="std std-ref">AdditionalData</span></a> (<code class="docutils literal notranslate"><span class="pre">data</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WithdrawCcdAmount ::=  (to: Receiver) (withdrawAmount: CCDAmount) (data: AdditionalData)

WithdrawMessageCcdAmount ::= (entryPoint: EntrypointName) (expiryTime: Timestamp) (nonce: Nonce) (serviceFeeRecipient: PublicKeyEd25519) (serviceFee: CCDAmount) (m: Byte²) (simpleWithdraws: WithdrawCcdAmountᵐ)

WithdrawBatchCcdAmount ::= (signer: PublicKeyEd25519) (signature: SignatureEd25519) (message: WithdrawMessageCcdAmount)

WithdrawParameterCcdAmount ::= (n: Byte²) (withdrawals: WithdrawBatchCcdAmountⁿ)
</pre></div>
</div>
</section>
<section id="ccd-receive-hook-parameter">
<span id="cis-5-functions-transfer-ccd-receive-hook-parameter"></span><h5>CCD Receive hook parameter<a class="headerlink" href="#ccd-receive-hook-parameter" title="Link to this heading">¶</a></h5>
<p>The parameter for the CCD receive hook function contains some additional data bytes.</p>
<p>It is serialized as several bytes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CCDReceiveHookParameter ::= (data: Byteᵐ)
</pre></div>
</div>
</section>
<section id="generating-a-valid-signature">
<h5>Generating a valid signature<a class="headerlink" href="#generating-a-valid-signature" title="Link to this heading">¶</a></h5>
<p>To generate a valid signature for the entry point, the following bytes have to be signed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WithdrawCCDSigningData ::= (chainContext: ChainContext) (param: WithdrawParameterCcdAmount)
</pre></div>
</div>
</section>
<section id="id3">
<h5>Requirements<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>The list of withdrawals MUST be executed in order.</p></li>
<li><p>The contract function MUST reject if any of the withdrawals fail to be executed.</p></li>
<li><p>The function MUST reject if the signature verification fails for any withdrawal.</p></li>
<li><p>The function MUST fail if the CCD balance of the <code class="docutils literal notranslate"><span class="pre">signer</span></code> is insufficient to do the withdrawal for any withdrawal.</p></li>
<li><p>A function MUST non-strictly decrease the CCD balance of the <code class="docutils literal notranslate"><span class="pre">signer```s</span> <span class="pre">public</span> <span class="pre">key</span> <span class="pre">and</span> <span class="pre">non-strictly</span> <span class="pre">increase</span> <span class="pre">the</span> <span class="pre">balance</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">``to</span></code> address or fail for any withdrawal.</p></li>
<li><p>A withdrawal back to this contract into the <code class="docutils literal notranslate"><span class="pre">depositCcd</span></code> entrypoint MUST be executed as a normal withdrawal.</p></li>
<li><p>A withdrawal of a CCD amount of zero MUST be executed as a normal withdrawal.</p></li>
<li><p>A withdrawal of any amount of CCD to a contract address MUST call a CCD receive hook function on the receiving smart contract with a <a class="reference internal" href="#cis-5-functions-transfer-ccd-receive-hook-parameter"><span class="std std-ref">ccd receive hook parameter</span></a>.</p></li>
<li><p>The contract function MUST reject if the CCD receive hook function called on the contract receiving CCDs rejects for any withdrawal.</p></li>
<li><p>The balance of a public key not owning any CCD amount SHOULD be treated as having a balance of zero.</p></li>
<li><p>The function MUST transfer the <code class="docutils literal notranslate"><span class="pre">serviceFee</span></code> to the <code class="docutils literal notranslate"><span class="pre">serviceFeeRecipient</span></code> for each batch withdrawal if <code class="docutils literal notranslate"><span class="pre">serviceFee!=0</span></code>.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be aware of transferring CCDs to a non-existing account address or contract address which results in an error on Concordium.
Checking the existence of an account address/ contract address would ideally be done off-chain before the message is even sent to the smart contract.</p>
</div>
</section>
</section>
<section id="withdrawcis2tokens">
<span id="cis-5-functions-withdrawcis2tokens"></span><h4><code class="docutils literal notranslate"><span class="pre">withdrawCis2Tokens</span></code><a class="headerlink" href="#withdrawcis2tokens" title="Link to this heading">¶</a></h4>
<p>The function executes a list of token withdrawals to native accounts and/or smart contracts out of the smart contract wallet.
This function MUST call the <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function on the CIS-2 token contract for every withdrawal.</p>
<section id="id4">
<h5>Parameter<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h5>
<p>The parameter is a list of withdrawals.</p>
<p>It is serialized as: 2 bytes representing the number of withdrawals (<code class="docutils literal notranslate"><span class="pre">n</span></code>) followed by the bytes for this number of <code class="docutils literal notranslate"><span class="pre">withdrawals</span></code>.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">WithdrawBatchTokenAmount</span></code> is serialized as: a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">signer</span></code>), a <a class="reference internal" href="#cis-5-signatureed25519"><span class="std std-ref">SignatureEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">signature</span></code>), and  a <code class="docutils literal notranslate"><span class="pre">WithdrawMessageTokenAmount</span></code> (<code class="docutils literal notranslate"><span class="pre">message</span></code>).</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">WithdrawMessageTokenAmount</span></code> is serialized as: an <a class="reference internal" href="#cis-5-entrypointname"><span class="std std-ref">EntrypointName</span></a> (<code class="docutils literal notranslate"><span class="pre">entryPoint</span></code>), a <a class="reference internal" href="#cis-5-timestamp"><span class="std std-ref">Timestamp</span></a> (<code class="docutils literal notranslate"><span class="pre">expiryTime</span></code>), a <a class="reference internal" href="#cis-5-nonce"><span class="std std-ref">Nonce</span></a> (<code class="docutils literal notranslate"><span class="pre">nonce</span></code>), a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">serviceFeeRecipient</span></code>), a <a class="reference internal" href="#cis-5-externaltokenamount"><span class="std std-ref">CIS5-ExternalTokenAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">serviceFee</span></code>), 2 bytes representing the number of simple withdraws (<code class="docutils literal notranslate"><span class="pre">m</span></code>) followed by the bytes for this number of simple withdraws (<code class="docutils literal notranslate"><span class="pre">simpleWithdraws</span></code>).</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">WithdrawTokenAmount</span></code> is serialized as: the receiving address <a class="reference internal" href="cis-2.html#cis-2-receiver"><span class="std std-ref">Receiver</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>), the <a class="reference internal" href="#cis-5-externaltokenamount"><span class="std std-ref">CIS5-ExternalTokenAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">withdrawAmount</span></code>), and some additional data <a class="reference internal" href="cis-2.html#cis-2-additionaldata"><span class="std std-ref">AdditionalData</span></a> (<code class="docutils literal notranslate"><span class="pre">data</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WithdrawTokenAmount ::=  (to: Receiver) (withdrawAmount: ExternalTokenAmount) (data: AdditionalData)

WithdrawMessageTokenAmount ::= (entryPoint: EntrypointName) (expiryTime: Timestamp) (nonce: Nonce) (serviceFeeRecipient: PublicKeyEd25519) (serviceFee: ExternalTokenAmount) (m: Byte²) (simpleWithdraws: WithdrawTokenAmountᵐ)

WithdrawBatchTokenAmount ::= (signer: PublicKeyEd25519) (signature: SignatureEd25519) (message: WithdrawMessageTokenAmount)

WithdrawParameterTokenAmount ::= (n: Byte²) (withdrawals: WithdrawBatchTokenAmountⁿ)
</pre></div>
</div>
</section>
<section id="id5">
<h5>Generating a valid signature<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h5>
<p>To generate a valid signature for the entry point, the following bytes have to be signed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WithdrawTokensSigningData ::= (chainContext: ChainContext) (param: WithdrawParameterTokenAmount)
</pre></div>
</div>
</section>
<section id="id6">
<h5>Requirements<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>The list of withdrawals MUST be executed in order.</p></li>
<li><p>The contract function MUST reject if any of the withdrawals fail to be executed.</p></li>
<li><p>The function MUST reject if the signature verification fails for any withdrawal.</p></li>
<li><p>This function MUST call the <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function on the CIS-2 token contract for every withdrawal.</p></li>
<li><p>The function MUST fail if the token balance of the <code class="docutils literal notranslate"><span class="pre">signer</span></code> is insufficient to do the withdrawal for any withdrawal.</p></li>
<li><p>A function MUST non-strictly decrease the token balance of the <code class="docutils literal notranslate"><span class="pre">signer</span></code> public key and non-strictly increase the balance of the <code class="docutils literal notranslate"><span class="pre">to</span></code> address or fail for any withdrawal.</p></li>
<li><p>A withdrawal back to this contract into the <code class="docutils literal notranslate"><span class="pre">depositCis2Tokens</span></code> entrypoint MUST be executed as a normal withdrawal.</p></li>
<li><p>A withdrawal of a token amount of zero MUST be executed as a normal withdrawal.</p></li>
<li><p>The balance of a public key not owning any tokens SHOULD be treated as having a balance of zero.</p></li>
<li><p>The function MUST transfer the <code class="docutils literal notranslate"><span class="pre">serviceFee</span></code> to the <code class="docutils literal notranslate"><span class="pre">serviceFeeRecipient</span></code> for each batch withdrawal if <code class="docutils literal notranslate"><span class="pre">serviceFee!=0</span></code>.</p></li>
</ul>
</section>
</section>
<section id="transferccd">
<span id="cis-5-functions-transferccd"></span><h4><code class="docutils literal notranslate"><span class="pre">transferCcd</span></code><a class="headerlink" href="#transferccd" title="Link to this heading">¶</a></h4>
<p>The function executes a list of CCD transfers to public keys within the smart contract wallet.</p>
<section id="id7">
<h5>Parameter<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h5>
<p>The parameter is a list of transfers.</p>
<p>It is serialized as: 2 bytes representing the number of transfers (<code class="docutils literal notranslate"><span class="pre">n</span></code>) followed by the bytes for this number of <code class="docutils literal notranslate"><span class="pre">transfers</span></code>.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">TransferBatchCcdAmount</span></code> is serialized as: a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">signer</span></code>), a <a class="reference internal" href="#cis-5-signatureed25519"><span class="std std-ref">SignatureEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">signature</span></code>), and  a <code class="docutils literal notranslate"><span class="pre">TransferMessageCcdAmount</span></code> (<code class="docutils literal notranslate"><span class="pre">message</span></code>).</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">TransferMessageCcdAmount</span></code> is serialized as: an <a class="reference internal" href="#cis-5-entrypointname"><span class="std std-ref">EntrypointName</span></a> (<code class="docutils literal notranslate"><span class="pre">entryPoint</span></code>), a <a class="reference internal" href="#cis-5-timestamp"><span class="std std-ref">Timestamp</span></a> (<code class="docutils literal notranslate"><span class="pre">expiryTime</span></code>), a <a class="reference internal" href="#cis-5-nonce"><span class="std std-ref">Nonce</span></a> (<code class="docutils literal notranslate"><span class="pre">nonce</span></code>), a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">serviceFeeRecipient</span></code>), a <a class="reference internal" href="#cis-5-ccdamount"><span class="std std-ref">CCDAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">serviceFee</span></code>), 2 bytes representing the number of simple transfers (<code class="docutils literal notranslate"><span class="pre">m</span></code>) followed by the bytes for this number of simple transers (<code class="docutils literal notranslate"><span class="pre">simpleTransfers</span></code>).</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">TransferCcdAmount</span></code> is serialized as: the receiving <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>), and the <a class="reference internal" href="#cis-5-ccdamount"><span class="std std-ref">CCDAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">transferAmount</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TransferCcdAmount ::=  (to: PublicKeyEd25519) (transferAmount: CCDAmount)

TransferMessageCcdAmount ::= (entryPoint: EntrypointName) (expiryTime: Timestamp) (nonce: Nonce) (serviceFeeRecipient: PublicKeyEd25519) (serviceFee: CCDAmount) (m: Byte²) (simpleTransfers: TransferCcdAmountᵐ)

TransferBatchCcdAmount ::=  (signer: PublicKeyEd25519) (signature: SignatureEd25519) (message: TransferMessageCcdAmount)

TransferParameterCcdAmount ::= (n: Byte²) (transfers: TransferBatchCcdAmount)
</pre></div>
</div>
</section>
<section id="id8">
<h5>Generating a valid signature<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h5>
<p>To generate a valid signature for the entry point, the following bytes have to be signed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TransferCCDSigningData ::= (chainContext: ChainContext) (param: TransferParameterCcdAmount)
</pre></div>
</div>
</section>
<section id="id9">
<h5>Requirements<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>The function MUST reject if the signature verification fails for any transfer.</p></li>
<li><p>The function MUST fail if the CCD balance of the <code class="docutils literal notranslate"><span class="pre">signer</span></code> is insufficient to do the transfer for any transfer.</p></li>
<li><p>A function MUST non-strictly decrease the CCD balance of the <code class="docutils literal notranslate"><span class="pre">signer</span></code> public key and non-strictly increase the balance of the <code class="docutils literal notranslate"><span class="pre">to</span></code> public key or fail for any transfer.</p></li>
<li><p>A transfer of a CCD amount of zero MUST be executed as a normal transfer.</p></li>
<li><p>The balance of a public key not owning any CCD amount SHOULD be treated as having a balance of zero.</p></li>
<li><p>The function MUST transfer the <code class="docutils literal notranslate"><span class="pre">serviceFee</span></code> to the <code class="docutils literal notranslate"><span class="pre">serviceFeeRecipient</span></code> for each batch transfer if <code class="docutils literal notranslate"><span class="pre">serviceFee!=0</span></code>.</p></li>
</ul>
</section>
</section>
<section id="transfercis2tokens">
<span id="cis-5-functions-transfercis2tokens"></span><h4><code class="docutils literal notranslate"><span class="pre">transferCis2Tokens</span></code><a class="headerlink" href="#transfercis2tokens" title="Link to this heading">¶</a></h4>
<p>The function executes a list of token transfers to public keys within the smart contract wallet.</p>
<section id="id10">
<h5>Parameter<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h5>
<p>The parameter is a list of transfers.</p>
<p>It is serialized as: 2 bytes representing the number of transfers (<code class="docutils literal notranslate"><span class="pre">n</span></code>) followed by the bytes for this number of <code class="docutils literal notranslate"><span class="pre">transfers</span></code>.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">TransferBatchTokenAmount</span></code> is serialized as: a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">signer</span></code>), a <a class="reference internal" href="#cis-5-signatureed25519"><span class="std std-ref">SignatureEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">signature</span></code>), and  a <code class="docutils literal notranslate"><span class="pre">TransferMessageTokenAmount</span></code> (<code class="docutils literal notranslate"><span class="pre">message</span></code>).</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">TransferMessageTokenAmount</span></code> is serialized as: an <a class="reference internal" href="#cis-5-entrypointname"><span class="std std-ref">EntrypointName</span></a> (<code class="docutils literal notranslate"><span class="pre">entryPoint</span></code>), a <a class="reference internal" href="#cis-5-timestamp"><span class="std std-ref">Timestamp</span></a> (<code class="docutils literal notranslate"><span class="pre">expiryTime</span></code>), a <a class="reference internal" href="#cis-5-nonce"><span class="std std-ref">Nonce</span></a> (<code class="docutils literal notranslate"><span class="pre">nonce</span></code>), a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">serviceFeeRecipient</span></code>), a <a class="reference internal" href="#cis-5-externaltokenamount"><span class="std std-ref">CIS5-ExternalTokenAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">serviceFee</span></code>), 2 bytes representing the number of simple transfers (<code class="docutils literal notranslate"><span class="pre">m</span></code>) followed by the bytes for this number of simple transfers (<code class="docutils literal notranslate"><span class="pre">simpleTransfers</span></code>).</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">TransferTokenAmount</span></code> is serialized as: the receiving <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">to</span></code>), the <a class="reference internal" href="#cis-5-externaltokenamount"><span class="std std-ref">CIS5-ExternalTokenAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">transferAmount</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TransferTokenAmount ::=  (to: PublicKeyEd25519) (transferAmount: ExternalTokenAmount)

TransferMessageTokenAmount ::= (entryPoint: EntrypointName) (expiryTime: Timestamp) (nonce: Nonce) (serviceFeeRecipient: PublicKeyEd25519) (serviceFee: ExternalTokenAmount) (m: Byte²) (simpletransfers: TransferTokenAmountᵐ)

TransferBatchTokenAmount ::= (signer: PublicKeyEd25519) (signature: SignatureEd25519) (message: TransferMessageTokenAmount)

TransferParameterTokenAmount ::= (n: Byte²) (transfers: TransferBatchTokenAmountⁿ)
</pre></div>
</div>
</section>
<section id="id11">
<h5>Generating a valid signature<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h5>
<p>To generate a valid signature for the entry point, the following bytes have to be signed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TransferTokensSigningData ::= (chainContext: ChainContext) (param: TransferParameterTokenAmount)
</pre></div>
</div>
</section>
<section id="id12">
<h5>Requirements<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>The function MUST reject if the signature verification fails for any of the transfers.</p></li>
<li><p>The function MUST fail if the token balance of the <code class="docutils literal notranslate"><span class="pre">signer</span></code> is insufficient to do the transfer for any transfer.</p></li>
<li><p>A function MUST non-strictly decrease the token balance of the <code class="docutils literal notranslate"><span class="pre">signer</span></code> public key and non-strictly increase the balance of the <code class="docutils literal notranslate"><span class="pre">to</span></code> public key or fail for any transfer.</p></li>
<li><p>A transfer of a token amount of zero MUST be executed as a normal transfer.</p></li>
<li><p>The balance of a public key not owning any tokens SHOULD be treated as having a balance of zero.</p></li>
<li><p>The function MUST transfer the <code class="docutils literal notranslate"><span class="pre">serviceFee</span></code> to the <code class="docutils literal notranslate"><span class="pre">serviceFeeRecipient</span></code> for each batch transfer if <code class="docutils literal notranslate"><span class="pre">serviceFee!=0</span></code>.</p></li>
</ul>
</section>
</section>
<section id="ccdbalanceof">
<span id="cis-5-functions-ccdbalanceof"></span><h4><code class="docutils literal notranslate"><span class="pre">ccdBalanceOf</span></code><a class="headerlink" href="#ccdbalanceof" title="Link to this heading">¶</a></h4>
<p>The function queries the CCD balances of a list of public keys.</p>
<section id="id13">
<h5>Parameter<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h5>
<p>The parameter consists of a list of public keys.</p>
<p>It is serialized as: 2 bytes for the number of public keys (<code class="docutils literal notranslate"><span class="pre">n</span></code>) and then this number of <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">publicKeys</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CCDBalanceOfParameter ::= (n: Byte²) (publicKeys: PublicKeyEd25519ⁿ)
</pre></div>
</div>
</section>
<section id="response">
<h5>Response<a class="headerlink" href="#response" title="Link to this heading">¶</a></h5>
<p>The function output response is a list of CCD amounts.</p>
<p>It is serialized as: 2 bytes for the number of CCD amounts (<code class="docutils literal notranslate"><span class="pre">n</span></code>) and then this number of <a class="reference internal" href="#cis-5-ccdamount"><span class="std std-ref">CCDAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">results</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CCDBalanceOfResponse ::= (n: Byte²) (results: CCDAmountⁿ)
</pre></div>
</div>
</section>
<section id="id14">
<h5>Requirements<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>The balance of a public key not owning any CCD  SHOULD be treated as having a balance of zero.</p></li>
<li><p>The number of results in the response MUST correspond to the number of the public keys in the parameter.</p></li>
<li><p>The order of results in the response MUST correspond to the order of public keys in the parameter.</p></li>
<li><p>The contract function MUST NOT increase or decrease the CCD balance or token balance of any public key for any token type.</p></li>
</ul>
</section>
</section>
<section id="cis2balanceof">
<span id="cis-5-functions-cis2balanceof"></span><h4><code class="docutils literal notranslate"><span class="pre">cis2BalanceOf</span></code><a class="headerlink" href="#cis2balanceof" title="Link to this heading">¶</a></h4>
<p>The function queries the token balances of a list of public keys for given token IDs, and CIS-2 token contract addresses.</p>
<section id="id15">
<h5>Parameter<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h5>
<p>The parameter consists of a list of token ID, CIS-2 token contract address, and public key triplets.</p>
<p>It is serialized as: 2 bytes for the number of queries (<code class="docutils literal notranslate"><span class="pre">n</span></code>) and then this number of queries (<code class="docutils literal notranslate"><span class="pre">queries</span></code>).
A query is serialized as a <a class="reference internal" href="#cis-5-tokenid"><span class="std std-ref">TokenID</span></a> (<code class="docutils literal notranslate"><span class="pre">tokenID</span></code>), a <a class="reference internal" href="#cis-5-contractaddress"><span class="std std-ref">ContractAddress</span></a> (<code class="docutils literal notranslate"><span class="pre">cis2TokenContractAddress</span></code>), and a <a class="reference internal" href="#cis-5-publickeyed25519"><span class="std std-ref">PublicKeyEd25519</span></a> (<code class="docutils literal notranslate"><span class="pre">publicKey</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cis2TokensBalanceOfQuery ::= (tokenID: TokenID) (cis2TokenContractAddress: ContractAddress) (publicKey: PublicKeyEd25519)

Cis2TokensBalanceOfParameter ::= (n: Byte²) (queries: Cis2TokensBalanceOfQueryⁿ)
</pre></div>
</div>
</section>
<section id="id16">
<h5>Response<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h5>
<p>The function output response is a list of token amounts.</p>
<p>It is serialized as: 2 bytes for the number of token amounts (<code class="docutils literal notranslate"><span class="pre">n</span></code>) and then this number of <a class="reference internal" href="#cis-5-tokenamount"><span class="std std-ref">TokenAmount</span></a> (<code class="docutils literal notranslate"><span class="pre">results</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cis2TokensBalanceOfResponse ::= (n: Byte²) (results: TokenAmountⁿ)
</pre></div>
</div>
</section>
<section id="id17">
<h5>Requirements<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>The balance of a public key not owning any amount of a token type SHOULD be treated as having a balance of zero.</p></li>
<li><p>The number of results in the response MUST correspond to the number of the queries in the parameter.</p></li>
<li><p>The order of results in the response MUST correspond to the order of queries in the parameter.</p></li>
<li><p>The contract function MUST NOT increase or decrease the CCD balance or token balance of any public key for any token type.</p></li>
</ul>
</section>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cis-6.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">CIS-6: Track-and-Trace Standard</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="cis-4.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">CIS-4: Credential Registry Standard</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021, Concordium
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">CIS-5: Smart Contract Wallet Standard</a><ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#general-types-and-serialization">General types and serialization</a><ul>
<li><a class="reference internal" href="#tokenid"><code class="docutils literal notranslate"><span class="pre">TokenID</span></code></a></li>
<li><a class="reference internal" href="#tokenamount"><code class="docutils literal notranslate"><span class="pre">TokenAmount</span></code></a></li>
<li><a class="reference internal" href="#cis5-externaltokenamount"><code class="docutils literal notranslate"><span class="pre">CIS5-ExternalTokenAmount</span></code></a></li>
<li><a class="reference internal" href="#accountaddress"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a></li>
<li><a class="reference internal" href="#contractaddress"><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code></a></li>
<li><a class="reference internal" href="#address"><code class="docutils literal notranslate"><span class="pre">Address</span></code></a></li>
<li><a class="reference internal" href="#entrypointname"><code class="docutils literal notranslate"><span class="pre">EntrypointName</span></code></a></li>
<li><a class="reference internal" href="#timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a></li>
<li><a class="reference internal" href="#nonce"><code class="docutils literal notranslate"><span class="pre">Nonce</span></code></a></li>
<li><a class="reference internal" href="#ccdamount"><code class="docutils literal notranslate"><span class="pre">CCDAmount</span></code></a></li>
<li><a class="reference internal" href="#publickeyed25519"><code class="docutils literal notranslate"><span class="pre">PublicKeyEd25519</span></code></a></li>
<li><a class="reference internal" href="#signatureed25519"><code class="docutils literal notranslate"><span class="pre">SignatureEd25519</span></code></a></li>
<li><a class="reference internal" href="#chaincontext"><code class="docutils literal notranslate"><span class="pre">ChainContext</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#logged-events">Logged events</a><ul>
<li><a class="reference internal" href="#nonceevent"><code class="docutils literal notranslate"><span class="pre">NonceEvent</span></code></a></li>
<li><a class="reference internal" href="#depositccdevent"><code class="docutils literal notranslate"><span class="pre">DepositCcdEvent</span></code></a></li>
<li><a class="reference internal" href="#depositcis2tokensevent"><code class="docutils literal notranslate"><span class="pre">DepositCis2TokensEvent</span></code></a></li>
<li><a class="reference internal" href="#withdrawccdevent"><code class="docutils literal notranslate"><span class="pre">WithdrawCcdEvent</span></code></a></li>
<li><a class="reference internal" href="#withdrawcis2tokensevent"><code class="docutils literal notranslate"><span class="pre">WithdrawCis2TokensEvent</span></code></a></li>
<li><a class="reference internal" href="#transferccdevent"><code class="docutils literal notranslate"><span class="pre">TransferCcdEvent</span></code></a></li>
<li><a class="reference internal" href="#transfercis2tokensevent"><code class="docutils literal notranslate"><span class="pre">TransferCis2TokensEvent</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#contract-functions">Contract functions</a><ul>
<li><a class="reference internal" href="#depositccd"><code class="docutils literal notranslate"><span class="pre">depositCcd</span></code></a><ul>
<li><a class="reference internal" href="#parameter">Parameter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#depositcis2tokens"><code class="docutils literal notranslate"><span class="pre">depositCis2Tokens</span></code></a><ul>
<li><a class="reference internal" href="#id1">Parameter</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#withdrawccd"><code class="docutils literal notranslate"><span class="pre">withdrawCcd</span></code></a><ul>
<li><a class="reference internal" href="#id2">Parameter</a></li>
<li><a class="reference internal" href="#ccd-receive-hook-parameter">CCD Receive hook parameter</a></li>
<li><a class="reference internal" href="#generating-a-valid-signature">Generating a valid signature</a></li>
<li><a class="reference internal" href="#id3">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#withdrawcis2tokens"><code class="docutils literal notranslate"><span class="pre">withdrawCis2Tokens</span></code></a><ul>
<li><a class="reference internal" href="#id4">Parameter</a></li>
<li><a class="reference internal" href="#id5">Generating a valid signature</a></li>
<li><a class="reference internal" href="#id6">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transferccd"><code class="docutils literal notranslate"><span class="pre">transferCcd</span></code></a><ul>
<li><a class="reference internal" href="#id7">Parameter</a></li>
<li><a class="reference internal" href="#id8">Generating a valid signature</a></li>
<li><a class="reference internal" href="#id9">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transfercis2tokens"><code class="docutils literal notranslate"><span class="pre">transferCis2Tokens</span></code></a><ul>
<li><a class="reference internal" href="#id10">Parameter</a></li>
<li><a class="reference internal" href="#id11">Generating a valid signature</a></li>
<li><a class="reference internal" href="#id12">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ccdbalanceof"><code class="docutils literal notranslate"><span class="pre">ccdBalanceOf</span></code></a><ul>
<li><a class="reference internal" href="#id13">Parameter</a></li>
<li><a class="reference internal" href="#response">Response</a></li>
<li><a class="reference internal" href="#id14">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cis2balanceof"><code class="docutils literal notranslate"><span class="pre">cis2BalanceOf</span></code></a><ul>
<li><a class="reference internal" href="#id15">Parameter</a></li>
<li><a class="reference internal" href="#id16">Response</a></li>
<li><a class="reference internal" href="#id17">Requirements</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>